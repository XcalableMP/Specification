\chapter{Directives}\index{directive}

This chapter describes the syntax and behavior of {\XMP} directives.
In this document, the following notation is used to describe {\XMP}
directives. 

\vspace{0.5cm}%

\begin{tabular}{ll}
{\tt xxx} & {\tt type-face} characters are used to indicate literal type characters. \\
{\it xxx...} & If the line is followed by ``...'', then xxx can be
repeated. \\
{\it [xxx]} & {\it xxx} is optional. \\
\verb![F]! & The following lines are effective only in {\Fort}. \\
\verb![C]! & The following lines are effective only in {\C}. \\
\end{tabular}

\section{Directive Format}

\subsection{General Rule}

In {\Fort}, {\XMP} directives are specified using special comments that
are identified by unique sentinels {\tt\verb|!$xmp|}. The rules of
{\Fort} directives in fixed source format and free source format follow
those in {\OMP} and HPF.  In {\C}, {\XMP} directives are specified using
the \verb|#pragma| mechanism provided by the {\C} standards.

\vspace{0.5cm}

\Syntax{directive}
\begin{tabular}{ll}
\verb![F]! & \verb|!$xmp| {\it directive-name clause} \\
& \\
\verb![C]! & \verb|#pragma xmp| {\it directive-name clause} \\
\end{tabular}

\vspace{0.5cm}

%Additionally, in {\Fort}, directives of the {\it attribute form}
%analogous to type declaration statements in Fortran using the ``{\tt
%::}'' punctuation can also be used.

Directives are classified as declarative directives and executable
directives. The declarative directive is a directive that may only be
placed in a declarative context. A declarative directive has no
associated executable user code. The scope rule of declarative
directives obeys that of the declaration statements in the base
language. For example, in C, node declarations by {\tt node} directives
are effective from the declaring point to the end of the function when
specified within a function, or of the file when specified outside any
functions, and, in {\Fort}, node declarations by {\tt node} directives
are effective within either the program unit, the derived-type
declaration or the interface body that immediately encloses the
directives.

The executable directives are placed in a executable context. A
stand-alone directive is an executable directive that has no associated
user code, such as a {\tt barrier} directive.
%
An executable directive and its associated user code make up an
{\XMP} construct, as in the following format:

\vspace{0.5cm}

\begin{tabular}{ll}
\verb![F]! & \verb|!$xmp| {\it directive-name clause} ...\\
 & \hspace{0.5cm} {\it statement} \\
\end{tabular}

\vspace{0.3cm}

\begin{tabular}{ll}
\verb![C]! & \verb|#pragma xmp| {\it directive-name clause} ...\\
 & \hspace{0.5cm} {\it statement} \\
\end{tabular}

\vspace{0.5cm}

Note that, in Fortran, a corresponding {\tt end} directive is required
for the {\tt task} and the {\tt tasks} constructs (see below)
and, in C, the associated statement can be a compound-statement.

\vspace{0.5cm}

\begin{tabular}{ll}
\verb![F]! & \verb|!$xmp tasks| \\
 & \hspace{0.5cm} {\it statement} \\
 & \hspace{0.5cm} ... \\
 & \verb|!$xmp| {\tt end tasks}\\
\end{tabular}


\subsection{Combined Directive}

\subsubsection*{Synopsis}

For the Fortran base language, declarative directives can be specified
in one combined directive, which is analogous to type declaration
statements in Fortran using the ``{\tt ::}'' punctuation.

\subsubsection*{Syntax}

\begin{center}
\begin{tabular}{llll}
\verb![F]! & \verb|!$xmp| {\it combined-directive} & {\bf is} & {\it
 combined-attribute} {\openb}, {\it combined-attribute}
 {\closeb}... {\tt ::} \\
 & & & {\it combined-decl} {\openb}, {\it combined-decl}
 {\closeb}...
\end{tabular}
\end{center}

{\it combined-attribute} is one of:

\vspace{0.3cm}

\begin{tabular}{ll}
 \hspace{0.5cm} & {\tt nodes} \\
 & {\tt template} \\
 & {\tt distribute} \verb|(|{\it dist-format} {\openb}, {\it
     dist-format}{\closeb}... \verb|)| {\tt onto} {\it nodes-name} \\
 & {\tt align} \verb|(| {\it align-source} {\openb}, {\it
     align-source}{\closeb}... \verb|)| \\
 & \hspace{4cm}{\tt with} {\it template-name} \verb|(|{\it
     align-subscript} {\openb}, {\it
     align-subscript}{\closeb}... \verb|)| \\
 & {\tt shadow} \verb|(| {\it shadow-width} {\openb},
     {\it shadow-width}{\closeb}... \verb|)| \\
 & {\tt dimension} \verb|(| {\it explicit-shape-spec} {\openb},
     {\it explicit-shape-spec}{\closeb}... \verb|)|
\end{tabular}

\vspace{0.3cm}

{\it combined-decl} is one of:

\vspace{0.3cm}

\begin{tabular}{ll}
 \hspace{0.5cm} & {\it nodes-name} \verb|(| {\it nodes-spec} {\openb},
 {\it nodes-spec} {\closeb}... \verb|)| \\
 & {\it nodes-name} \verb|(| {\it nodes-spec} {\openb}, {\it nodes-spec}
     {\closeb}... \verb|)| {\tt = *} \\
 & {\it nodes-name} \verb|(| {\it nodes-spec} {\openb}, {\it nodes-spec}
     {\closeb}... \verb|)| {\tt =} {\it nodes-ref} \\
 & {\it template-name} \verb|(| {\it template-spec} {\openb}, {\it
     template-spec} {\closeb}... \verb|)| \\
 & {\it array-name}
\end{tabular}

\subsubsection*{Description}

A combined directives is interpreted as if an object corresponding to
each {\it combined-decl} is declared in a directive corresponding to
each {\it combined-attribute}, where all restrictions of each directive,
in addition to the following ones, are applied.

\subsubsection*{Restrictions}

\begin{itemize}
 \item The same kind of {\it combined-attribute} must not appear more
       than once in a given {\it combined-directive}.
 \item If the {\tt dimension} attribute appears in a {\it
       combined-directive}, any object to which it applies must be
       declared with either the {\tt template} or the {\tt nodes}
       attribute.
\end{itemize}
